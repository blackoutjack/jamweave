--- closure-orig/src/com/google/javascript/jscomp/parsing/parser/Parser.java	2014-10-23 11:43:01.883685919 -0500
+++ closure/src/com/google/javascript/jscomp/parsing/parser/Parser.java	2014-12-21 14:19:48.674978173 -0600
@@ -546,6 +546,12 @@
     return peek(index, TokenType.FUNCTION);
   }
 
+  // JAM begin
+  private boolean peekTransaction() {
+    return peek(0, TokenType.TRANSACTION);
+  }
+  // JAM end
+
   private ParseTree parseArrowFunction(Expression expressionIn) {
     SourcePosition start = getTreeStartLocation();
 
@@ -617,6 +623,38 @@
         FunctionDeclarationTree.Kind.EXPRESSION);
   }
 
+  // JAM begin
+  private ParseTree parseTransaction() {
+    SourcePosition start = getTreeStartLocation();
+    eat(TokenType.TRANSACTION);
+
+    eat(TokenType.OPEN_PAREN);
+    ParseTree introspector = parseExpression();
+    eat(TokenType.CLOSE_PAREN);
+    ParseTree transactionBody = parseStatement();
+
+    TransactionStatementTree transaction =  new TransactionStatementTree(
+        getTreeLocation(start), introspector, transactionBody);
+
+    return transaction;
+  }
+
+  private ParseTree parseTransactionExpression() {
+    SourcePosition start = getTreeStartLocation();
+    eat(TokenType.TRANSACTION);
+
+    eat(TokenType.OPEN_PAREN);
+    ParseTree introspector = parseExpression();
+    eat(TokenType.CLOSE_PAREN);
+    BlockTree transactionBody = parseBlock();
+
+    TransactionExpressionTree transaction =  new TransactionExpressionTree(
+        getTreeLocation(start), introspector, transactionBody);
+
+    return transaction;
+  }
+  // JAM end 
+
   private FormalParameterListTree parseFormalParameterList() {
     SourcePosition listStart = getTreeStartLocation();
     eat(TokenType.OPEN_PAREN);
@@ -746,6 +784,10 @@
       return parseTryStatement();
     case DEBUGGER:
       return parseDebuggerStatement();
+    // JAM begin
+    case TRANSACTION:
+      return parseTransaction();
+    // JAM end
     default:
       if (peekLabelledStatement()) {
         return parseLabelledStatement();
@@ -808,6 +850,9 @@
     case MINUS:
     case TILDE:
     case BANG:
+    // JAM begin
+    case TRANSACTION:
+    // JAM end
       return true;
     default:
       return false;
@@ -1312,6 +1357,10 @@
     case SLASH:
     case SLASH_EQUAL:
       return parseRegularExpressionLiteral();
+    // JAM begin
+    case TRANSACTION:
+      return parseTransactionExpression();  
+    // JAM end
     default:
       return parseMissingPrimaryExpression();
     }

